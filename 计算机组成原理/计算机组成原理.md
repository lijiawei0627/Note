# 一、计算机系统概论

## 计算机系统性能指标

### 非时间指标

* 主存容量：是指一台计算机主存所包含的存储单元总数。
* 存储带宽：指单位时间内与主存交换的二进制信息量，常用单位`B/S`（字节/秒）。（影响存储带宽的指标包括数据位宽和数据传输速率）。

### 时间指标

主频f/时钟周期T , 外频、倍频、 CPI 

* **主频 f ：**指CPU内核工作的时钟频率，即CPU内数字脉冲信号振荡的速率，与 CPU实际的运算能力之间不是唯一的、直接关系；
* **时钟周期T：** 也称节拍周期，是计算机中最基本的、最小的时间单位。在一个时 钟周期内，CPU仅完成一个最基本的动作；
* f 与 T的关系 互为倒数， f 越高，T就越小 `(f =100MHz时T=10ns， f =1GHz时 T=1ns)`。

* **外频：** 指CPU(内存)与主板之间 同步的时钟频率(系统总 线的工作频率)；

* **倍频：** CPU主频与外频之间的倍数；

  主频 =  外频 × 倍频 

  如：`Pentium 4 2.4G CPU主频` 

  `2400M = 133M (外频) × 18 (倍频)`

*  **CPI ：**执行一条指令(平均)需要的时钟周期数(即T周期的个数)

  CPI = 程序中所有指令的时钟周期数之和 / 程序指令总数 

  ​       = (程序中各类指令的CPI×程序中该类指令的比例)

  例1 某计算机指令系统中各类指令所占比例及CPI如下表所示，求程序的CPI

  ![image-20191215155856388](http://img.lijiawei0627.xyz/img/image-20191215155856388.png)

 CPI = `1*60% + 2*18% + 4*12% +8*10% = 2.24`

*  **MIPS** ： 每秒钟CPU能执行的指令总条数 (单位：百万条/秒)

  ![image-20191215160034862](http://img.lijiawei0627.xyz/img/image-20191215160034862.png)

## 计算机性能指标是确定的吗？

不是的。

![image-20191215160123273](http://img.lijiawei0627.xyz/img/image-20191215160123273.png)

# 二、数据表示

## 机器数及其特点

**目的：**组织数据,方便计算机硬件直接使用。 

### 考虑因素

* 支持的数据类型
* 能表示的数据范围
* 能表示的数据精度
* 存储和处理的代价
* 是否有利于软件的移植等

### 机器数内的数据表示

1. 真值：符号用“+”、“-”表示的数据表示方法。 

2. 机器数：符号数值化的数据表示方法, 用0、1表示符号。 

3. 三种常见的机器数：设定点数的形式为`X0 X1 X2 X3 … Xn`

   ![image-20191215161754861](http://img.lijiawei0627.xyz/img/image-20191215161754861.png)

### 例子 

求下列各数的原码、补码和反码 

![image-20191215161855602](http://img.lijiawei0627.xyz/img/image-20191215161855602.png)

#### 原码、反码、补码之间的相互转换

正数的原码，反码，补码都是相同的，所以此处只针对于负数

* 原码转反码

符号位不变，数值位按位取反

* 反码转原码

符号位不变，数值位按位取反

* 原码转补码

符号位不变，数值位按位取反，末位再加１

* 补码转原码

符号位不变，数值位按位取反，末位再加１．即补码的补码等于原码

* 已知补码，求原码的负数的补码

符号位和数值位都按位取反，末位再加１

## 常见机器数的特点

### 原码

* 表示简单
* 运算复杂：符号不参与运算，要设置加法、减法器
* 0的表示不唯一

**[X]原 + [Y]原**

**（不能直接判定是执行加法还是减法运算，分同好和异号）**

### 反码

* 表示相对原码复杂

* 运算相对原码简单：符号位参与运算，只需要设置加法器，但符号位的进位位需要加到最低位

  ![image-20191215163039359](http://img.lijiawei0627.xyz/img/image-20191215163039359.png)

* 0的表示不唯一

### 补码

* 表示相对原码复杂
* 运算简单：只需要设置加法器
* 0的表示唯一

**补码中模的概念 （符号位进位后所在位的权值）**

## 定点数与浮点数的表示

### 定点数据表示

![image-20191215165651642](http://img.lijiawei0627.xyz/img/image-20191215165651642.png)

### 浮点数据表示

**把数的范围和精度分别表示的一种数据表示方法**

**浮点数的使用场合** 

当数的表示范围超出了定点数能表示的范围时。 

#### 格式

![image-20191215165824226](http://img.lijiawei0627.xyz/img/image-20191215165824226.png)

#### IEEE 754格式

![image-20191215165916696](http://img.lijiawei0627.xyz/img/image-20191215165916696.png)

`IEEE754`标准中规定：

* float单精度浮点数在机器中表示用 1 位表示数字的符号，用 8 位来表示指数，用23 位来表示尾数，即小数部分。
* 对于double双精度浮点数，用 1 位表示符号，用 11 位表示指数，52 位表示尾数，其中指数域称为阶码。

指数采用偏移值，其中单精度偏移值为127，双精度为1023，将浮点数的阶码值变成非负整数,便于浮点数的比较和排序。

由上述可知，与上述`IEEE754`格式相对应的32位浮点数的真值可表示为:

![image-20191215170214591](http://img.lijiawei0627.xyz/img/image-20191215170214591.png)

`IEEE754`  32位浮点数与对应真值之间的变换流程

![image-20191215170345491](http://img.lijiawei0627.xyz/img/image-20191215170345491.png)

#### 例子

![image-20191215170503812](http://img.lijiawei0627.xyz/img/image-20191215170503812.png)

[IEEE754格式具体解析](https://blog.csdn.net/crjmail/article/details/79723051)

## 数据校验的基本原理

### 数据校验的必要性

* 受元器件的质量、电路故障或噪音干扰等因素的影响，数据 在被处理、传输、存储的过程中可能出现错误
* 若能设计硬件层面的错误检测机制，可以减少基于软件检错 的代价（系统观）。

### 校验的基本原理

增加冗余码（校验位） 

![image-20191215172601674](http://img.lijiawei0627.xyz/img/image-20191215172601674.png)

### 码距的概念

* 编码系统中任意两个合法编码（码字）之间不同的二进制数位数。

* 0011与0001 的码距为1，一位错误时无法识别；
* 0000、0011、0101、0110、1001、1010、1100、1111等编码码 距为2。任何一位发生改变，如0000变成1000就从有效编码变成了 无效编码，容易检测到这种错误。
* 校验码中增加冗余项的目的就是为了增大码距。

### 码距与检错或纠错能力的关系

![image-20191215172651418](http://img.lijiawei0627.xyz/img/image-20191215172651418.png)

### 选择码距要考虑的因素

* 码距越大，抗干扰能力越强，纠错能力越强，数据冗余越大， 编码效率低，编码电路也相对复杂；
* 选择码距必须考虑信息发生差错的概率和系统能容许的最小差错率

## 奇偶校验

## 什么是奇偶校验码

奇偶校验码也是一种校验码，它用来检测数据传输过程中是否发生错误，是众多校验码中最为简单的一种。

顾名思义，它有两种校验方法：奇校验和偶校验

**奇校验：原始码流+校验位 总共有奇数个1**

**偶校验：原始码流+校验位 总共有偶数个1**

**它的校验位只有一位，要么是0，要么是1**。并且它的校验码还可以放在码流的前面。

# 三、运算方法与运算器（后续学习）

## 定点数加法运算

任意两数的补码之和等于该两数之和的补码。这是补码加法的理论基础。

**[X]补+[Y]补=[X+Y]补**  （mod $2^n+1$）

![image-20191215193913782](http://img.lijiawei0627.xyz/img/image-20191215193913782.png)

### 特点

* 符号位要作为数的一部分一起参加运算

* 要在模$2^n+1$的意义下相加，即超过$2^n+1$的进位要丢掉

  **例如：**[x]补=01011，[y]补=11011 （五位）

  ​			[x]补 + [y]补 = [x + y]补 = **100110** （结果为六位）

  ​			x + y = +0110

## 定点数减法运算 

**[X-Y]补=[X]补− [Y]补 =[X]补+[− Y]补** 

![image-20191215194854276](http://img.lijiawei0627.xyz/img/image-20191215194854276.png)

可知 ： 通过右向左扫描[Y]补 ，在遇到数字1及之前，直接输出遇到的数字， 遇到1之后，取反输出，即可得到[-Y]补，反之亦然！

## 溢出概念

在定点整数机器中，数的表示范围|x| < ($2^n+1$)。在运算过程中如出现大于字长绝对值的现象，称为溢出。

![image-20191215195537504](http://img.lijiawei0627.xyz/img/image-20191215195537504.png)

两个正数相加，结果大于机器字长所能表示的最大正数，称为**正溢**。

当两个负数相加，结果小于机器所能表示的最小负数，称为**负溢**

## 溢出的检测方法 

溢出只可能发生在同符号数相加时，包括[X]补与[Y]补； [X]补与[-Y]同号； 

两种检测方法

* 双符号位法，又称为“变形补码”

  采用变形补码后，任何正数，两个符号位都是“0”，即$00x_n-1x_n-2\cdots$$x_1x_2$；

  任何负数，两个符号位都是“1”，即$11x_n-1x_n-2\cdots$$x_1x_2$；如果两数相加之后，其结果的符号位出现“01”或者“10”两种组合，表示发生溢出。

  

  例子：x = +1100， y = +1000，求x + y。

  [x]补  = **00**1100     [y]补 = **00**1000

  [x]补  +  [y]补  = 010100

  两个符号位出现“01”，表示溢出，即结果大于$+x^n$

  由此可知，当以变形补码运算，运算结果的二符号位相异时，表示溢出；相同时，表示未溢出。

* 单符号法，对最高数据位进位和符号进位进行检测 

  设运算时最高数据位产生的进位为`C1`，符号位产生的进位为`C0`

  溢出检测电路为： `V=` `C0` $\bigoplus$ `C 1`

  ![image-20191215202224869](http://img.lijiawei0627.xyz/img/image-20191215202224869.png)

  当最高数据位产生进位而符号位无进位时，产生正溢

  当最高数据位无进位而符号位有进位时，产生负溢

## 定点乘法运算

# 四、存储系统

## 存储系统层次结构

### 主存速度慢的原因

* 主存增速与CPU增速不同步； 
* 指令执行期间多次访问存储器

### 主存容量不足的原因

* 存在制约主存容量的技术因素 由CPU、主板等相关技术指标确定
* 应用对主存的需求不断扩大

### 存储体系的层次化结构

![image-20191215211430323](http://img.lijiawei0627.xyz/img/image-20191215211430323.png)

CPU能直接访问的存储器称为内存储器，它包括cache与主存储器。CPU不能直接访问外存储其，外存储器的信息必须调入内存储器才能为CPU进行处理

**CPU访问到的存储系统具有Cache的速度，辅存的容量和价格**

### 存储体系层次化结构的理论基础

* **时间局部性**: 现在被访问的信息2在不久的将来还将再次被访问;
  时间局部性的程序结构体现：循环结构 

* **空间局部性**： 现访问信息2 ，下一次访问2附近的信息。
  空间局部性的程序结构体现：顺序结构

![image-20191215211615662](http://img.lijiawei0627.xyz/img/image-20191215211615662.png)

## `SRAM`存储器（静态存储器）

### `SRAM`存储单元结构

![image-20191215214448243](http://img.lijiawei0627.xyz/img/image-20191215214448243.png)

* 工作管： `T1、 T2`  (保存数据)
* 负载管： `T3、 T4`  （补充电荷） 
* 门控管： `T5、T6 、T7、T8` （开关作用）

所有的`SRAM`的特征是用一个锁存器（触发器）作为存储元。只要直流供电电源一直加在这个记忆电路上，它旧无限期地保持记忆的1状态或0状态。如果电源断电，那么存储的数据（1或0）就会丢失。

> 注意：读写操作不会同时发生

### 基本的`SRAM`逻辑结构

目前的`SRAM`芯片采用双译码方式，以便组织更大的存储容量。

## `DRAM`存储器（动态存储器）

动态`MOS`随机读写存储器`DRAM`的存储容量极大，通常用作计算机的主存储器。`SRAM`存储器的存储元是一个触发器，它有两个稳定的状态。

## Cache的基本原理

cache是一种高速缓冲存储器，是为了解决CPU和主存之间速度不匹配而采用的一项重要技术。其原理基于程序运行中具有的空间局部性和时间局部性特性。

cache的组成：高速的`SRAM`和控制逻辑（若cache在CPU芯片外，它的控制逻辑一般与主存控制逻辑合成在一起；若cache在CPU内，则有CPU提供它的控制逻辑）

![image-20191222151547179](http://img.lijiawei0627.xyz/img/image-20191222151547179.png)

### Cache的工作过程

当随着半导体器件集成度的进一步提高，cache已放入CPU中，其工作速度接近于CPU速度，从而能组成两级以上的cache系统。

**CPU与cache之间的数据交换是以字为单位，而cache与主存之间的数据交换是以块为单位。一个块由若干字组成，是定长的。当CPU读取内存中一个字时，便发出此字的 内存地址到cache和主存。此时cache控制逻辑依据地址判断此字当前是否在cache中：若是，此字立即传送给CPU；若非，则用主存读周期把此字从主存读出送到CPU，与此同时，把含有这个字的整个数据块从主存读出送到cache中**

### Cache地址映射机制

为了把主存块放到cache中，必须应用某种方法把主存地址定位到cache中，称做**地址映射**。

![image-20191222153059806](http://img.lijiawei0627.xyz/img/image-20191222153059806.png)

* Cache被分成若干行，每行的大小与主存块相同
* Cache每行包含四部分，是Cache要保存的信息。Tag从CPU访问主存的地址中剥离得到、Data是与主存交换的数据块、Valid表示Cache中的数据是否有效、`Drity`表示主存中得到数据是最新。

## 地址映射方式

### 全相联映射方式

主存中的一个块直接拷贝到cache中的任意一行上，非常灵活，对于主存中的数据块可以拷贝到cache中的哪一行不做硬性规定。

特点

* 缺点：硬件控制复杂，尤其是用于比较“主存块号”与tag时的比较器电路难于设计与实现。
* 优点：Cache利用率高；块冲突率低
* 应用场合：小容量Cache

### 直接映射方式

一个主存块只能拷贝到cache的一个特定行位置去。

特点

* 缺点：每个主存块只有一个固定的行位置可存放；Cache利用率低；块冲突率高
* 优点：淘汰算法简单
* 应用场合：大容量Cache

### 组相联映射方式

全相联映射和直接映射两种方式的优缺点刚好相反，从存放的灵活性和命中率来看，前者为优；从比较器电路简单及硬件投资来说，后者为佳，而组相联映射方式是前两种方式的折衷方案。

将cache的空间分为若干组，主存块与cache组之间直接映射，而组内各块之间全相联映射。

## Cache结构

![image-20191222153504480](http://img.lijiawei0627.xyz/img/image-20191222153504480.png)

## 替换算法

程序运行一段时间后，Cache存储空间被占满，当再有新数据要调入时，就需要通过某种机制决定替换的对象。

- 先进先出算法——`FIFO`

  ![image-20191222163708228](http://img.lijiawei0627.xyz/img/image-20191222163708228.png)

- 最不经常使用算法——`LFU`

  ![image-20191222163716948](http://img.lijiawei0627.xyz/img/image-20191222163716948.png)

- 近期最少使用算法——`LRU`

  ![image-20191222163746318](http://img.lijiawei0627.xyz/img/image-20191222163746318.png)

- 随机替换算法

* 替换算法的抖动——以`FIFO`为例

  ![image-20191222163814727](http://img.lijiawei0627.xyz/img/image-20191222163814727.png)

  

# 五、指令系统

# 六、中央处理器